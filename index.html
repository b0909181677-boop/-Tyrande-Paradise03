<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>泰蘭德劇場手寫筆記本</title>
    <!-- 引入手寫風格字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&family=Ma+Shan+Zheng&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --paper-color: #f4ecd8;
            --line-color: #dcd0b8;
            --accent-color: #8b7355;
            --text-color: #4a3728;
        }

        body {
            background-color: var(--paper-color);
            background-image: 
                radial-gradient(circle at 2px 2px, var(--line-color) 1px, transparent 0);
            background-size: 30px 30px;
            color: var(--text-color);
            font-family: 'Ma+Shan+Zheng', 'Noto+Sans+TC', cursive;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .handwritten {
            font-family: 'Ma+Shan+Zheng', cursive;
        }

        /* 筆記本容器 */
        .notebook-container {
            max-width: 800px;
            margin: 0 auto;
            background: #fffef9;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            border: 2px solid var(--accent-color);
            position: relative;
        }

        .notebook-container::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            border-left: 2px dashed var(--accent-color);
            opacity: 0.3;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        /* 標籤頁排列 - 手機端自動換行 */
        .tabs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-button {
            background: var(--line-color);
            padding: 8px 15px;
            border-radius: 20px 20px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--accent-color);
            font-size: 1.1rem;
        }

        .tab-button.active {
            background: #fffef9;
            border-bottom: 2px solid #fffef9;
            transform: translateY(2px);
            font-weight: bold;
        }

        /* 按鈕區域 */
        .content-area {
            border-top: 2px solid var(--accent-color);
            padding-top: 20px;
            min-height: 300px;
        }

        .buttons-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .drama-btn {
            background: white;
            border: 1.5px solid var(--accent-color);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.1s;
            box-shadow: 2px 2px 0px var(--accent-color);
        }

        .drama-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 0px 0px 0px var(--accent-color);
        }

        .add-action-btn {
            background: #e8f5e9;
            border: 1px dashed #4caf50;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: #2e7d32;
        }

        /* 彈窗樣式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: #fffef9;
            width: 100%;
            max-width: 500px;
            padding: 25px;
            border-radius: 15px;
            border: 3px solid var(--accent-color);
            position: relative;
        }

        textarea {
            width: 100%;
            height: 150px;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--line-color);
            font-family: inherit;
            font-size: 1.2rem;
            line-height: 1.8;
            resize: none;
            outline: none;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .primary-btn {
            background: var(--accent-color);
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .danger-btn {
            background: #d32f2f;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* 標籤管理 */
        .tag-manager {
            margin-top: 40px;
            text-align: center;
            border-top: 1px dashed var(--accent-color);
            padding-top: 20px;
        }
    </style>
</head>
<body>

<div class="notebook-container">
    <h1 class="handwritten">泰蘭德劇場</h1>

    <div id="tabs" class="tabs-container">
        <!-- 標籤按鈕會由 JS 生成 -->
    </div>

    <div class="content-area">
        <div id="buttonsGrid" class="buttons-grid">
            <!-- 劇名按鈕會由 JS 生成 -->
        </div>
    </div>

    <div class="tag-manager">
        <button onclick="addNewTag()" class="add-action-btn">+ 新增標籤</button>
        <button onclick="deleteCurrentTag()" class="danger-btn" style="background:#8b735544; color:#4a3728; border:1px solid #8b7355; margin-left: 10px;">刪除此標籤</button>
    </div>
</div>

<!-- 筆記彈窗 -->
<div id="noteModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle" class="handwritten text-xl font-bold">編輯筆記</h2>
            <button onclick="closeModal()">✕</button>
        </div>
        <div class="mb-4">
            <label class="block text-sm opacity-60">劇名：</label>
            <input id="editDramaName" type="text" class="w-full bg-transparent border-b border-gray-300 focus:outline-none text-lg">
        </div>
        <label class="block text-sm opacity-60">心得筆記：</label>
        <textarea id="noteContent" placeholder="寫下你的感想..."></textarea>
        <div class="btn-group">
            <button onclick="deleteDrama()" class="danger-btn">刪除此劇</button>
            <button onclick="saveNote()" class="primary-btn">儲存</button>
        </div>
    </div>
</div>

<script>
    // 初始數據
    let initialTags = [
        "Off&Gun", "Tay&New", "Pound&Phwim", "Joong&Dunk", 
        "Boun&Prem", "Earth&Mix", "Ohm&Nanon", "Force&Book", 
        "Aou&Boom", "Jimmy&Sea", "First&Khaotung", "Gemini&Fourth", 
        "Perth&Chimon", "William&Est", "Mile&Apo", "福桃", "其他"
    ];

    let notebookData = JSON.parse(localStorage.getItem('thailand_drama_notes')) || {};
    
    // 如果是第一次使用，初始化標籤
    if (Object.keys(notebookData).length === 0) {
        initialTags.forEach(tag => {
            notebookData[tag] = [];
        });
    }

    let currentTag = Object.keys(notebookData)[0] || "其他";
    let editingDramaIndex = -1;

    // 初始化渲染
    function init() {
        renderTabs();
        renderButtons();
    }

    // 渲染標籤頁
    function renderTabs() {
        const tabsDiv = document.getElementById('tabs');
        tabsDiv.innerHTML = '';
        Object.keys(notebookData).forEach(tag => {
            const btn = document.createElement('div');
            btn.className = `tab-button ${tag === currentTag ? 'active' : ''}`;
            btn.innerText = tag;
            btn.onclick = () => {
                currentTag = tag;
                renderTabs();
                renderButtons();
            };
            tabsDiv.appendChild(btn);
        });
    }

    // 渲染內容按鈕
    function renderButtons() {
        const grid = document.getElementById('buttonsGrid');
        grid.innerHTML = '';
        
        const dramas = notebookData[currentTag] || [];
        
        dramas.forEach((drama, index) => {
            const btn = document.createElement('button');
            btn.className = 'drama-btn';
            btn.innerText = drama.name;
            btn.onclick = () => openModal(index);
            grid.appendChild(btn);
        });

        // 新增劇名按鈕
        const addBtn = document.createElement('button');
        addBtn.className = 'add-action-btn';
        addBtn.innerText = '+ 新增劇目';
        addBtn.onclick = () => openModal(-1);
        grid.appendChild(addBtn);
    }

    // 彈窗功能
    function openModal(index) {
        editingDramaIndex = index;
        const modal = document.getElementById('noteModal');
        const titleInput = document.getElementById('editDramaName');
        const contentArea = document.getElementById('noteContent');
        
        if (index === -1) {
            titleInput.value = '';
            contentArea.value = '';
            document.getElementById('modalTitle').innerText = '新增劇目';
        } else {
            const data = notebookData[currentTag][index];
            titleInput.value = data.name;
            contentArea.value = data.note || '';
            document.getElementById('modalTitle').innerText = '編輯筆記';
        }
        
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('noteModal').style.display = 'none';
    }

    function saveNote() {
        const name = document.getElementById('editDramaName').value.trim();
        const note = document.getElementById('noteContent').value;
        
        if (!name) {
            alert('請輸入劇名');
            return;
        }

        if (editingDramaIndex === -1) {
            // 新增
            notebookData[currentTag].push({ name, note });
        } else {
            // 編輯
            notebookData[currentTag][editingDramaIndex] = { name, note };
        }
        
        saveToLocalStorage();
        renderButtons();
        closeModal();
    }

    function deleteDrama() {
        if (editingDramaIndex === -1) {
            closeModal();
            return;
        }
        if (confirm('確定要刪除這部劇的紀錄嗎？')) {
            notebookData[currentTag].splice(editingDramaIndex, 1);
            saveToLocalStorage();
            renderButtons();
            closeModal();
        }
    }

    // 標籤管理功能
    function addNewTag() {
        const tagName = prompt('請輸入新標籤名稱（如：CP名或公司名）：');
        if (tagName && tagName.trim()) {
            if (notebookData[tagName.trim()]) {
                alert('標籤已存在');
                return;
            }
            notebookData[tagName.trim()] = [];
            currentTag = tagName.trim();
            saveToLocalStorage();
            renderTabs();
            renderButtons();
        }
    }

    function deleteCurrentTag() {
        if (Object.keys(notebookData).length <= 1) {
            alert('至少需保留一個標籤');
            return;
        }
        if (confirm(`確定要刪除「${currentTag}」及其所有劇目紀錄嗎？`)) {
            delete notebookData[currentTag];
            currentTag = Object.keys(notebookData)[0];
            saveToLocalStorage();
            renderTabs();
            renderButtons();
        }
    }

    function saveToLocalStorage() {
        localStorage.setItem('thailand_drama_notes', JSON.stringify(notebookData));
    }

    // 點擊背景關閉彈窗
    window.onclick = function(event) {
        const modal = document.getElementById('noteModal');
        if (event.target == modal) {
            closeModal();
        }
    }

    init();
</script>

</body>
</html>